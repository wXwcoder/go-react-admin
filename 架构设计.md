# go-react-admin 项目架构设计

## 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    Client (React Frontend)                  │
└─────────────────────────────┬───────────────────────────────┘
                              │ HTTPS/API
┌─────────────────────────────▼───────────────────────────────┐
│                      Load Balancer                          │
└─────────────────────────────┬───────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
┌───────▼────────┐   ┌───────▼────────┐   ┌───────▼────────┐
│  Web Server 1  │   │  Web Server 2  │   │  Web Server N  │
│  (Gin Backend) │   │  (Gin Backend) │   │  (Gin Backend) │
└───────┬────────┘   └───────┬────────┘   └───────┬────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                    ┌─────────▼─────────┐
                    │     Redis         │
                    │  (Session/Cache)  │
                    └─────────┬─────────┘
                              │
                    ┌─────────▼─────────┐
                    │     MySQL         │
                    │  (Multi-tenant)   │
                    └───────────────────┘
```

## 技术选型

### 后端技术栈
- **编程语言**: Golang
- **Web框架**: Gin
- **ORM框架**: GORM
- **权限控制**: Casbin
- **认证机制**: JWT
- **配置管理**: Viper (YAML)
- **日志框架**: Zap
- **缓存**: Redis
- **数据库**: MySQL (8.0+)
- **API文档**: Swagger

### 前端技术栈
- **框架**: React 18+
- **状态管理**: Redux Toolkit
- **UI库**: Ant Design
- **路由**: React Router v6
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **主题**: 支持黑白两套主题

### 基础设施
- **容器化**: Docker
- **编排**: Docker Compose
- **反向代理**: Nginx
- **监控**: Prometheus + Grafana

## 目录结构设计

### 后端目录结构
```
server/
├── api/                 # API接口定义
│   └── v1/              # v1版本API
├── config/              # 配置文件
├── core/                # 核心组件
├── docs/                # 文档
├── global/              # 全局变量
├── initialize/          # 初始化模块
├── middleware/          # 中间件
├── model/               # 数据模型
│   ├── request/         # 请求结构体
│   └── response/        # 响应结构体
├── router/              # 路由配置
├── service/             # 业务逻辑层
├── source/              # 初始数据
└── utils/               # 工具包
```

### 前端目录结构
```
web/
├── public/              # 静态资源
├── src/
│   ├── api/             # API调用封装
│   ├── assets/          # 静态资源
│   ├── components/      # 公共组件
│   ├── config/          # 配置文件
│   ├── layouts/         # 页面布局
│   ├── pages/           # 页面组件
│   ├── routes/          # 路由配置
│   ├── store/           # 状态管理
│   ├── styles/          # 样式文件
│   ├── utils/           # 工具函数
│   ├── App.tsx          # 根组件
│   └── main.tsx         # 入口文件
├── index.html           # HTML模板
└── vite.config.ts       # 构建配置
```

## 模块设计

### 1. 认证授权模块
- 用户登录/登出
- JWT Token生成与验证
- 权限验证(Casbin)
- 多点登录限制

### 2. 用户管理模块
- 用户信息维护
- 用户状态管理
- 用户角色分配

### 3. 角色权限模块
- 角色管理
- 菜单权限分配
- API权限分配

### 4. 菜单管理模块
- 动态菜单生成
- 菜单层级管理
- 角色菜单关联

### 5. API管理模块
- API接口管理
- API分组管理
- 接口权限控制

### 6. 日志管理模块
- 登录日志记录
- 操作日志记录
- 数据埋点收集

### 7. 多租户模块
- 租户信息管理
- 租户数据隔离
- 租户权限控制

## 数据库设计

### 多租户实现方案
采用共享数据库，独立模式(Schema)的方式实现多租户：
- 所有租户共享同一个数据库实例
- 每个租户拥有独立的Schema
- 通过中间件自动切换Schema

### 核心数据表
1. **用户表 (users)**
2. **角色表 (roles)**
3. **菜单表 (menus)**
4. **API表 (apis)**
5. **角色-菜单关联表 (role_menus)**
6. **角色-API关联表 (role_apis)**
7. **登录日志表 (login_logs)**
8. **操作日志表 (operation_logs)**
9. **租户表 (tenants)**

## 安全设计

### 1. 认证安全
- JWT Token过期机制
- Refresh Token机制
- 密码加密存储(Bcrypt)

### 2. 接口安全
- 请求签名验证
- 防重放攻击
- 输入参数校验

### 3. 数据安全
- 敏感数据加密
- 数据库连接加密
- 备份与恢复机制

## 部署架构

### 开发环境
- 本地运行Gin服务
- 本地运行React开发服务器
- Docker Compose一键启动依赖服务

### 生产环境
- Nginx反向代理
- 多实例Gin服务
- 负载均衡
- Redis集群
- MySQL主从复制